---
title: DirectX 中的手和运动控制器
description: 开始在本机 DirectX 应用中使用手动跟踪和运动控制器的开发人员指南。
author: caseymeekhof
ms.author: cmeekhof
ms.date: 08/04/2020
ms.topic: article
keywords: 双手，运动控制器，directx，输入，全息影像，混合现实耳机，windows mixed reality 耳机，虚拟现实耳机
ms.openlocfilehash: 843065ccc0989f9c3bc2ad494503ee46d08d0d77
ms.sourcegitcommit: d3a3b4f13b3728cfdd4d43035c806c0791d3f2fe
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/20/2021
ms.locfileid: "98580799"
---
# <a name="hands-and-motion-controllers-in-directx"></a><span data-ttu-id="68d82-104">DirectX 中的手和运动控制器</span><span class="sxs-lookup"><span data-stu-id="68d82-104">Hands and motion controllers in DirectX</span></span>

> [!NOTE]
> <span data-ttu-id="68d82-105">本文与旧版 WinRT 本机 Api 相关。</span><span class="sxs-lookup"><span data-stu-id="68d82-105">This article relates to the legacy WinRT native APIs.</span></span>  <span data-ttu-id="68d82-106">对于新的本机应用项目，建议使用 **[OPENXR API](openxr-getting-started.md)**。</span><span class="sxs-lookup"><span data-stu-id="68d82-106">For new native app projects, we recommend using the **[OpenXR API](openxr-getting-started.md)**.</span></span>

<span data-ttu-id="68d82-107">在 Windows Mixed Reality 中，手动和 [运动控制器](../../design/motion-controllers.md) 输入都是通过空间输入 api 处理的，该空间输入 Api 位于 [Windows. input](/uwp/api/windows.ui.input.spatial) 命名空间中。</span><span class="sxs-lookup"><span data-stu-id="68d82-107">In Windows Mixed Reality, both hand and [motion controller](../../design/motion-controllers.md) input is handled through the spatial input APIs, found in the [Windows.UI.Input.Spatial](/uwp/api/windows.ui.input.spatial) namespace.</span></span> <span data-ttu-id="68d82-108">这使您能够轻松地处理常见的操作，例如在双手和运动控制器中 **选择** "按相同方式"。</span><span class="sxs-lookup"><span data-stu-id="68d82-108">This enables you to easily handle common actions like **Select** presses the same way across both hands and motion controllers.</span></span>

## <a name="getting-started"></a><span data-ttu-id="68d82-109">入门</span><span class="sxs-lookup"><span data-stu-id="68d82-109">Getting started</span></span>

<span data-ttu-id="68d82-110">若要访问 Windows Mixed Reality 中的空间输入，请从 SpatialInteractionManager 接口开始。</span><span class="sxs-lookup"><span data-stu-id="68d82-110">To access spatial input in Windows Mixed Reality, start with the SpatialInteractionManager interface.</span></span>  <span data-ttu-id="68d82-111">可以通过调用  [SpatialInteractionManager：： GetForCurrentView](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.getforcurrentview)访问此接口，通常在应用启动期间进行。</span><span class="sxs-lookup"><span data-stu-id="68d82-111">You can access this interface by calling  [SpatialInteractionManager::GetForCurrentView](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.getforcurrentview), typically sometime during app startup.</span></span>

```cpp
using namespace winrt::Windows::UI::Input::Spatial;

SpatialInteractionManager interactionManager = SpatialInteractionManager::GetForCurrentView();
```

<span data-ttu-id="68d82-112">SpatialInteractionManager 的作业是提供对 [SpatialInteractionSources](//uwp/api/windows.ui.input.spatial.spatialinteractionsource)（表示输入源）的访问权限。</span><span class="sxs-lookup"><span data-stu-id="68d82-112">The SpatialInteractionManager's job is to provide access to [SpatialInteractionSources](//uwp/api/windows.ui.input.spatial.spatialinteractionsource), which represent a source of input.</span></span>  <span data-ttu-id="68d82-113">系统中提供了三种 SpatialInteractionSources。</span><span class="sxs-lookup"><span data-stu-id="68d82-113">There are three kinds of SpatialInteractionSources available in the system.</span></span>
* <span data-ttu-id="68d82-114">**手型** 表示用户检测到的手。</span><span class="sxs-lookup"><span data-stu-id="68d82-114">**Hand** represents a user's detected hand.</span></span> <span data-ttu-id="68d82-115">手动源根据设备提供不同的功能，范围从 HoloLens 上的基本手势到 HoloLens 2 上的完全表述的手动跟踪。</span><span class="sxs-lookup"><span data-stu-id="68d82-115">Hand sources offer different features based on the device, ranging from basic gestures on HoloLens to fully articulated hand tracking on HoloLens 2.</span></span> 
* <span data-ttu-id="68d82-116">**控制器** 表示配对的运动控制器。</span><span class="sxs-lookup"><span data-stu-id="68d82-116">**Controller** represents a paired motion controller.</span></span> <span data-ttu-id="68d82-117">运动控制器可以提供不同的功能，例如，选择触发器、菜单按钮、"抓住按钮"、"触摸板" 和 "thumbsticks"。</span><span class="sxs-lookup"><span data-stu-id="68d82-117">Motion controllers can offer different capabilities, for example, Select triggers, Menu buttons, Grasp buttons, touchpads, and thumbsticks.</span></span>
* <span data-ttu-id="68d82-118">**语音** 表示用户在系统中检测到的语音关键字。</span><span class="sxs-lookup"><span data-stu-id="68d82-118">**Voice** represents the user's voice speaking system-detected keywords.</span></span> <span data-ttu-id="68d82-119">例如，每当用户显示 "选择" 时，此源都会注入一个选择按下和释放。</span><span class="sxs-lookup"><span data-stu-id="68d82-119">For example, this source will inject a Select press and release whenever the user says "Select".</span></span>

<span data-ttu-id="68d82-120">源的每帧数据由  [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) 接口表示。</span><span class="sxs-lookup"><span data-stu-id="68d82-120">Per-frame data for a source is represented by the  [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) interface.</span></span> <span data-ttu-id="68d82-121">可以通过两种不同的方式来访问此数据，这取决于您是要在应用程序中使用基于事件驱动或基于轮询的模型。</span><span class="sxs-lookup"><span data-stu-id="68d82-121">There are two different ways to access this data, depending on whether you want to use an event-driven or polling-based model in your application.</span></span>

### <a name="event-driven-input"></a><span data-ttu-id="68d82-122">事件驱动的输入</span><span class="sxs-lookup"><span data-stu-id="68d82-122">Event-driven input</span></span>
<span data-ttu-id="68d82-123">SpatialInteractionManager 提供了多个应用可以侦听的事件。</span><span class="sxs-lookup"><span data-stu-id="68d82-123">The SpatialInteractionManager provides a number of events that your app can listen for.</span></span>  <span data-ttu-id="68d82-124">一些示例包括   [SourcePressed](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcepressed)、[SourceReleased 和 [SourceUpdated](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourceupdated)。</span><span class="sxs-lookup"><span data-stu-id="68d82-124">A few examples include   [SourcePressed](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcepressed), [SourceReleased, and [SourceUpdated](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourceupdated).</span></span>

<span data-ttu-id="68d82-125">例如，下面的代码将名为 MyApp：： OnSourcePressed 的事件处理程序挂接到 SourcePressed 事件。</span><span class="sxs-lookup"><span data-stu-id="68d82-125">For example, the following code hooks up an event handler called MyApp::OnSourcePressed to the SourcePressed event.</span></span>  <span data-ttu-id="68d82-126">这允许你的应用检测任何类型的交互源的按下操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-126">This allows your app to detect presses on any type of interaction source.</span></span>

```cpp
using namespace winrt::Windows::UI::Input::Spatial;

auto interactionManager = SpatialInteractionManager::GetForCurrentView();
interactionManager.SourcePressed({ this, &MyApp::OnSourcePressed });

```

<span data-ttu-id="68d82-127">此按下的事件将在按下时与相应的 SpatialInteractionSourceState 一起异步发送到您的应用程序。</span><span class="sxs-lookup"><span data-stu-id="68d82-127">This pressed event is sent to your app asynchronously, along with the corresponding SpatialInteractionSourceState at the time the press happened.</span></span> <span data-ttu-id="68d82-128">您的应用程序或游戏引擎可能想要立即开始处理，或在输入处理例程中排队事件数据。</span><span class="sxs-lookup"><span data-stu-id="68d82-128">Your app or game engine may want to start processing right away or queue up the event data in your input processing routine.</span></span> <span data-ttu-id="68d82-129">下面是 SourcePressed 事件的事件处理程序函数，用于检查是否已按下 "选择" 按钮。</span><span class="sxs-lookup"><span data-stu-id="68d82-129">Here's an event handler function for the SourcePressed event, which checks whether the select button has been pressed.</span></span>

```cpp
using namespace winrt::Windows::UI::Input::Spatial;

void MyApp::OnSourcePressed(SpatialInteractionManager const& sender, SpatialInteractionSourceEventArgs const& args)
{
    if (args.PressKind() == SpatialInteractionPressKind::Select)
    {
        // Select button was pressed, update app state
    }
}
```

<span data-ttu-id="68d82-130">上述代码仅检查 "Select" 按下，它对应于设备上的主要操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-130">The above code only checks for the 'Select' press, which corresponds to the primary action on the device.</span></span> <span data-ttu-id="68d82-131">示例包括在 HoloLens 上执行 AirTap 或在运动控制器上拉取触发器。</span><span class="sxs-lookup"><span data-stu-id="68d82-131">Examples include doing an AirTap on HoloLens or pulling the trigger on a motion controller.</span></span>  <span data-ttu-id="68d82-132">"选择" 按下表示用户激活其目标全息图的意图。</span><span class="sxs-lookup"><span data-stu-id="68d82-132">'Select' presses represent the user's intention to activate the hologram they're targeting.</span></span>  <span data-ttu-id="68d82-133">将为多个不同的按钮和手势触发 SourcePressed 事件，您可以检查 SpatialInteractionSource 上的其他属性，以测试这些情况。</span><span class="sxs-lookup"><span data-stu-id="68d82-133">The SourcePressed event will fire for a number of different buttons and gestures, and you can inspect other properties on the SpatialInteractionSource to test for those cases.</span></span>

### <a name="polling-based-input"></a><span data-ttu-id="68d82-134">基于轮询的输入</span><span class="sxs-lookup"><span data-stu-id="68d82-134">Polling-based input</span></span>
<span data-ttu-id="68d82-135">还可以使用 SpatialInteractionManager 轮询每个帧的当前输入状态。</span><span class="sxs-lookup"><span data-stu-id="68d82-135">You can also use SpatialInteractionManager to poll for the current state of input every frame.</span></span>  <span data-ttu-id="68d82-136">为此，请在每个帧上调用 [GetDetectedSourcesAtTimestamp](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.getdetectedsourcesattimestamp) 。</span><span class="sxs-lookup"><span data-stu-id="68d82-136">To do this, call [GetDetectedSourcesAtTimestamp](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.getdetectedsourcesattimestamp) every frame.</span></span>  <span data-ttu-id="68d82-137">此函数返回一个数组，其中包含每个活动[SpatialInteractionSource](//uwp/api/windows.ui.input.spatial.spatialinteractionsource)的一个[SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) 。</span><span class="sxs-lookup"><span data-stu-id="68d82-137">This function returns an array containing one [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) for every active [SpatialInteractionSource](//uwp/api/windows.ui.input.spatial.spatialinteractionsource).</span></span> <span data-ttu-id="68d82-138">这意味着每个活动的运动控制器有一个，每次被跟踪，一个用于语音，另一个用于语音。</span><span class="sxs-lookup"><span data-stu-id="68d82-138">This means one for each active motion controller, one for each tracked hand, and one for speech if a 'select' command was recently uttered.</span></span> <span data-ttu-id="68d82-139">然后，你可以检查每个 SpatialInteractionSourceState 上的属性以将输入驱动到你的应用程序中。</span><span class="sxs-lookup"><span data-stu-id="68d82-139">You can then inspect the properties on each SpatialInteractionSourceState to drive input into your application.</span></span> 

<span data-ttu-id="68d82-140">下面的示例演示如何使用轮询方法检查 "select" 操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-140">Here's an example of how to check for the 'select' action using the polling method.</span></span> <span data-ttu-id="68d82-141">*预测* 变量表示可从 [HolographicFrame](//uwp/api/windows.graphics.holographic.holographicframe)中获取的 [HolographicFramePrediction](//uwp/api/Windows.Graphics.Holographic.HolographicFramePrediction)对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-141">The *prediction* variable represents a [HolographicFramePrediction](//uwp/api/Windows.Graphics.Holographic.HolographicFramePrediction) object, which can be obtained from the [HolographicFrame](//uwp/api/windows.graphics.holographic.holographicframe).</span></span>

```cpp
using namespace winrt::Windows::UI::Input::Spatial;

auto interactionManager = SpatialInteractionManager::GetForCurrentView();
auto sourceStates = m_spatialInteractionManager.GetDetectedSourcesAtTimestamp(prediction.Timestamp());

for (auto& sourceState : sourceStates)
{
    if (sourceState.IsSelectPressed())
    {
        // Select button is down, update app state
    }
}
```

<span data-ttu-id="68d82-142">每个 SpatialInteractionSource 都有一个 ID，可用于标识新源并将现有源从帧关联到帧。</span><span class="sxs-lookup"><span data-stu-id="68d82-142">Each SpatialInteractionSource has an ID, which you can use to identify new sources and correlate existing sources from frame to frame.</span></span>  <span data-ttu-id="68d82-143">每次离开并进入 FOV 时，都可以获得新的 ID，但在会话期间，控制器 Id 会保持静态。</span><span class="sxs-lookup"><span data-stu-id="68d82-143">Hands get a new ID every time they leave and enter the FOV, but controller IDs remain static for the duration of the session.</span></span>  <span data-ttu-id="68d82-144">您可以使用 SpatialInteractionManager （如 [SourceDetected](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcedetected) 和 [SourceLost](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcelost)）上的事件来做出手动输入或离开设备的视图，或者当动作控制器开启/关闭或配对/不成对时做出反应。</span><span class="sxs-lookup"><span data-stu-id="68d82-144">You can use the events on SpatialInteractionManager such as [SourceDetected](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcedetected) and [SourceLost](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcelost), to react when hands enter or leave the device's view, or when motion controllers are turned on/off or are paired/unpaired.</span></span>

### <a name="predicted-vs-historical-poses"></a><span data-ttu-id="68d82-145">预测与历史记录</span><span class="sxs-lookup"><span data-stu-id="68d82-145">Predicted vs. historical poses</span></span>
<span data-ttu-id="68d82-146">GetDetectedSourcesAtTimestamp 具有 timestamp 参数。</span><span class="sxs-lookup"><span data-stu-id="68d82-146">GetDetectedSourcesAtTimestamp has a timestamp parameter.</span></span> <span data-ttu-id="68d82-147">这使您可以请求状态并引发预测或历史数据，从而使您可以将空间交互与其他输入源关联起来。</span><span class="sxs-lookup"><span data-stu-id="68d82-147">This enables you to request state and pose data that is either predicted or historical, letting you correlate spatial interactions with other sources of input.</span></span> <span data-ttu-id="68d82-148">例如，在呈现当前帧中的位置时，可以传入由 [HolographicFrame](//uwp/api/windows.graphics.holographic.holographicframe)提供的预测时间戳。</span><span class="sxs-lookup"><span data-stu-id="68d82-148">For example, when rendering the hand's position in the current frame, you can pass in the predicted timestamp provided by the [HolographicFrame](//uwp/api/windows.graphics.holographic.holographicframe).</span></span> <span data-ttu-id="68d82-149">这样一来，系统就可以向前预测该位置，使其与呈现的帧输出保持一致，从而最大程度地减少感觉滞后时间。</span><span class="sxs-lookup"><span data-stu-id="68d82-149">This enables the system to forward-predict the hand position to closely align with the rendered frame output, minimizing perceived latency.</span></span>

<span data-ttu-id="68d82-150">但是，这种预测的姿势并不会生成适合于交互源的最佳定点光线。</span><span class="sxs-lookup"><span data-stu-id="68d82-150">However, such a predicted pose doesn't produce an ideal pointing ray for targeting with an interaction source.</span></span> <span data-ttu-id="68d82-151">例如，按下运动控制器按钮时，该事件最多需要20毫秒才能通过蓝牙向上向上冒泡到操作系统。</span><span class="sxs-lookup"><span data-stu-id="68d82-151">For example, when a motion controller button is pressed, it can take up to 20 ms for that event to bubble up through Bluetooth to the operating system.</span></span> <span data-ttu-id="68d82-152">同样，在用户执行手型手势后，在系统检测到该笔势之前一定会经历一定的时间，然后应用程序会轮询该手势。</span><span class="sxs-lookup"><span data-stu-id="68d82-152">Similarly, after a user does a hand gesture, some amount of time may pass before the system detects the gesture and your app then polls for it.</span></span> <span data-ttu-id="68d82-153">当应用程序轮询状态更改时，使用的是过去发生的这种交互的头和手。</span><span class="sxs-lookup"><span data-stu-id="68d82-153">By the time your app polls for a state change, the head and hand poses used to target that interaction actually happened in the past.</span></span> <span data-ttu-id="68d82-154">如果目标是将当前 HolographicFrame 的时间戳传递给 GetDetectedSourcesAtTimestamp，则会在显示帧时将姿势预测到目标射线，这可能会在将来的 20 ms 以上。</span><span class="sxs-lookup"><span data-stu-id="68d82-154">If you target by passing your current HolographicFrame's timestamp to GetDetectedSourcesAtTimestamp, the pose will instead be forward predicted to the targeting ray at the time the frame will be displayed, which could be more than 20 ms in the future.</span></span> <span data-ttu-id="68d82-155">这种未来的理由适用于 *渲染* 交互源，但会因为用户在过去发生的目标问题而为 *交互提供了* 时间问题。</span><span class="sxs-lookup"><span data-stu-id="68d82-155">This future pose is good for *rendering* the interaction source, but compounds our time problem for *targeting* the interaction, as the user's targeting occurred in the past.</span></span>

<span data-ttu-id="68d82-156">幸运的是， [SourcePressed](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcepressed)、[SourceReleased 和 [SourceUpdated](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourceupdated) 事件提供与每个输入事件关联的历史 [状态](//uwp/api/windows.ui.input.spatial.spatialinteractionsourceeventargs.state) 。</span><span class="sxs-lookup"><span data-stu-id="68d82-156">Fortunately, the [SourcePressed](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcepressed), [SourceReleased, and [SourceUpdated](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourceupdated) events provide the historical [State](//uwp/api/windows.ui.input.spatial.spatialinteractionsourceeventargs.state) associated with each input event.</span></span>  <span data-ttu-id="68d82-157">这直接包括通过 [TryGetPointerPose](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.trygetpointerpose)提供的历史头和手中的内容，以及可传递给其他 api 以与此事件关联的历史 [时间戳](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.timestamp) 。</span><span class="sxs-lookup"><span data-stu-id="68d82-157">This directly includes the historical head and hand poses available through [TryGetPointerPose](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.trygetpointerpose), along with a historical [Timestamp](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.timestamp) that you can pass to other APIs to correlate with this event.</span></span>

<span data-ttu-id="68d82-158">这会在每个帧呈现和定位时提供以下最佳做法：</span><span class="sxs-lookup"><span data-stu-id="68d82-158">That leads to the following best practices when rendering and targeting with hands and controllers each frame:</span></span>
* <span data-ttu-id="68d82-159">对于呈现每个帧的 **手动/控制器** ，应用应按照当前帧的 photon 时间 **轮询** 每个交互源的 **前预测** 姿势。</span><span class="sxs-lookup"><span data-stu-id="68d82-159">For **hand/controller rendering** each frame, your app should **poll** for the **forward-predicted** pose of each interaction source at the current frame’s photon time.</span></span>  <span data-ttu-id="68d82-160">可以通过调用每个帧的 [GetDetectedSourcesAtTimestamp](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.getdetectedsourcesattimestamp) 来轮询所有交互源，并传入 [HolographicFrame：： CurrentPrediction](//uwp/api/windows.graphics.holographic.holographicframe.currentprediction)提供的预测时间戳。</span><span class="sxs-lookup"><span data-stu-id="68d82-160">You can poll for all interaction sources by calling [GetDetectedSourcesAtTimestamp](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.getdetectedsourcesattimestamp) each frame, passing in the predicted timestamp provided by [HolographicFrame::CurrentPrediction](//uwp/api/windows.graphics.holographic.holographicframe.currentprediction).</span></span>
* <span data-ttu-id="68d82-161">对于在按下或释放时的 **手动/控制器目标** ，你的应用程序应处理按下/已释放的 **事件**，raycasting **基于该事件的打印头或** 手。</span><span class="sxs-lookup"><span data-stu-id="68d82-161">For **hand/controller targeting** upon a press or release, your app should handle pressed/released **events**, raycasting based on the **historical** head or hand pose for that event.</span></span> <span data-ttu-id="68d82-162">可以通过以下方式获取此目标射线：处理 [SourcePressed](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcepressed) 或 [SourceReleased](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcereleased) 事件，从事件参数获取 [状态](//uwp/api/windows.ui.input.spatial.spatialinteractionsourceeventargs.state) 属性，然后调用其 [TryGetPointerPose](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.trygetpointerpose) 方法。</span><span class="sxs-lookup"><span data-stu-id="68d82-162">You get this targeting ray by handling the [SourcePressed](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcepressed) or [SourceReleased](//uwp/api/windows.ui.input.spatial.spatialinteractionmanager.sourcereleased) event, getting the [State](//uwp/api/windows.ui.input.spatial.spatialinteractionsourceeventargs.state) property from the event arguments, and then calling its [TryGetPointerPose](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.trygetpointerpose) method.</span></span>

## <a name="cross-device-input-properties"></a><span data-ttu-id="68d82-163">跨设备输入属性</span><span class="sxs-lookup"><span data-stu-id="68d82-163">Cross-device input properties</span></span>
<span data-ttu-id="68d82-164">SpatialInteractionSource API 支持使用各种功能的控制器和手动跟踪系统。</span><span class="sxs-lookup"><span data-stu-id="68d82-164">The SpatialInteractionSource API supports controllers and hand tracking systems with a wide range of capabilities.</span></span> <span data-ttu-id="68d82-165">许多这些功能在设备类型之间是通用的。</span><span class="sxs-lookup"><span data-stu-id="68d82-165">A number of these capabilities are common between device types.</span></span> <span data-ttu-id="68d82-166">例如，手动跟踪和运动控制器都提供 "选择" 操作和三维位置。</span><span class="sxs-lookup"><span data-stu-id="68d82-166">For example, hand tracking and motion controllers both provide a 'select' action and a 3D position.</span></span> <span data-ttu-id="68d82-167">只要有可能，API 就会将这些常见功能映射到 SpatialInteractionSource 上的相同属性。</span><span class="sxs-lookup"><span data-stu-id="68d82-167">Wherever possible, the API maps these common capabilities to the same properties on the SpatialInteractionSource.</span></span>  <span data-ttu-id="68d82-168">这使应用程序能够更轻松地支持各种输入类型。</span><span class="sxs-lookup"><span data-stu-id="68d82-168">This enables applications to more easily support a wide range of input types.</span></span> <span data-ttu-id="68d82-169">下表介绍了支持的属性，以及它们如何跨输入类型进行比较。</span><span class="sxs-lookup"><span data-stu-id="68d82-169">The following table describes the properties that are supported, and how they compare across input types.</span></span>

| <span data-ttu-id="68d82-170">properties</span><span class="sxs-lookup"><span data-stu-id="68d82-170">Property</span></span> | <span data-ttu-id="68d82-171">说明</span><span class="sxs-lookup"><span data-stu-id="68d82-171">Description</span></span> | <span data-ttu-id="68d82-172">HoloLens (第一代) 手势</span><span class="sxs-lookup"><span data-stu-id="68d82-172">HoloLens(1st gen) Gestures</span></span> | <span data-ttu-id="68d82-173">运动控制器</span><span class="sxs-lookup"><span data-stu-id="68d82-173">Motion Controllers</span></span> | <span data-ttu-id="68d82-174">明确表述</span><span class="sxs-lookup"><span data-stu-id="68d82-174">Articulated Hands</span></span>|
|--- |--- |--- |--- |--- |
| [<span data-ttu-id="68d82-175">SpatialInteractionSource：：**左右手使用习惯**</span><span class="sxs-lookup"><span data-stu-id="68d82-175">SpatialInteractionSource::**Handedness**</span></span>](//uwp/api/windows.ui.input.spatial.spatialinteractionsource.handedness) | <span data-ttu-id="68d82-176">Right 或 left 右手/controller。</span><span class="sxs-lookup"><span data-stu-id="68d82-176">Right or left hand / controller.</span></span> | <span data-ttu-id="68d82-177">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-177">Not Supported</span></span> | <span data-ttu-id="68d82-178">支持</span><span class="sxs-lookup"><span data-stu-id="68d82-178">Supported</span></span> | <span data-ttu-id="68d82-179">支持</span><span class="sxs-lookup"><span data-stu-id="68d82-179">Supported</span></span> |
| [<span data-ttu-id="68d82-180">SpatialInteractionSourceState：：**IsSelectPressed**</span><span class="sxs-lookup"><span data-stu-id="68d82-180">SpatialInteractionSourceState::**IsSelectPressed**</span></span>](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.isselectpressed) | <span data-ttu-id="68d82-181">主要按钮的当前状态。</span><span class="sxs-lookup"><span data-stu-id="68d82-181">Current state of the primary button.</span></span> | <span data-ttu-id="68d82-182">Air</span><span class="sxs-lookup"><span data-stu-id="68d82-182">Air Tap</span></span> | <span data-ttu-id="68d82-183">触发器</span><span class="sxs-lookup"><span data-stu-id="68d82-183">Trigger</span></span> | <span data-ttu-id="68d82-184">宽松 (直立的喷) </span><span class="sxs-lookup"><span data-stu-id="68d82-184">Relaxed Air Tap (upright pinch)</span></span> |
| [<span data-ttu-id="68d82-185">SpatialInteractionSourceState：：**IsGrasped**</span><span class="sxs-lookup"><span data-stu-id="68d82-185">SpatialInteractionSourceState::**IsGrasped**</span></span>](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.isgrasped) | <span data-ttu-id="68d82-186">抓取按钮的当前状态。</span><span class="sxs-lookup"><span data-stu-id="68d82-186">Current state of the grab button.</span></span> | <span data-ttu-id="68d82-187">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-187">Not Supported</span></span> | <span data-ttu-id="68d82-188">抓取按钮</span><span class="sxs-lookup"><span data-stu-id="68d82-188">Grab button</span></span> | <span data-ttu-id="68d82-189">挤压或合上</span><span class="sxs-lookup"><span data-stu-id="68d82-189">Pinch or Closed Hand</span></span> |
| [<span data-ttu-id="68d82-190">SpatialInteractionSourceState：：**IsMenuPressed**</span><span class="sxs-lookup"><span data-stu-id="68d82-190">SpatialInteractionSourceState::**IsMenuPressed**</span></span>](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.ismenupressed) | <span data-ttu-id="68d82-191">菜单按钮的当前状态。</span><span class="sxs-lookup"><span data-stu-id="68d82-191">Current state of the menu button.</span></span>    | <span data-ttu-id="68d82-192">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-192">Not Supported</span></span> | <span data-ttu-id="68d82-193">菜单按钮</span><span class="sxs-lookup"><span data-stu-id="68d82-193">Menu Button</span></span> | <span data-ttu-id="68d82-194">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-194">Not Supported</span></span> |
| [<span data-ttu-id="68d82-195">SpatialInteractionSourceLocation：：**Position**</span><span class="sxs-lookup"><span data-stu-id="68d82-195">SpatialInteractionSourceLocation::**Position**</span></span>](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcelocation.position) | <span data-ttu-id="68d82-196">控制器上的抓手或抓握位置的 XYZ 位置。</span><span class="sxs-lookup"><span data-stu-id="68d82-196">XYZ location of the hand or grip position on the controller.</span></span> | <span data-ttu-id="68d82-197">掌上位置</span><span class="sxs-lookup"><span data-stu-id="68d82-197">Palm location</span></span> | <span data-ttu-id="68d82-198">抓握姿势位置</span><span class="sxs-lookup"><span data-stu-id="68d82-198">Grip pose position</span></span> | <span data-ttu-id="68d82-199">掌上位置</span><span class="sxs-lookup"><span data-stu-id="68d82-199">Palm location</span></span> |
| [<span data-ttu-id="68d82-200">SpatialInteractionSourceLocation：：**取向**</span><span class="sxs-lookup"><span data-stu-id="68d82-200">SpatialInteractionSourceLocation::**Orientation**</span></span>](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcelocation.orientation) | <span data-ttu-id="68d82-201">表示手柄在控制器上的方向的四元数。</span><span class="sxs-lookup"><span data-stu-id="68d82-201">Quaternion representing the orientation of the hand or grip pose on the controller.</span></span> | <span data-ttu-id="68d82-202">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-202">Not Supported</span></span> | <span data-ttu-id="68d82-203">抓住姿势方向</span><span class="sxs-lookup"><span data-stu-id="68d82-203">Grip pose orientation</span></span> | <span data-ttu-id="68d82-204">棕榈方向</span><span class="sxs-lookup"><span data-stu-id="68d82-204">Palm orientation</span></span> |
| [<span data-ttu-id="68d82-205">SpatialPointerInteractionSourcePose：：**Position**</span><span class="sxs-lookup"><span data-stu-id="68d82-205">SpatialPointerInteractionSourcePose::**Position**</span></span>](//uwp/api/windows.ui.input.spatial.spatialpointerinteractionsourcepose.position#Windows_UI_Input_Spatial_SpatialPointerInteractionSourcePose_Position) | <span data-ttu-id="68d82-206">指针射线的原点。</span><span class="sxs-lookup"><span data-stu-id="68d82-206">Origin of the pointing ray.</span></span> | <span data-ttu-id="68d82-207">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-207">Not Supported</span></span> | <span data-ttu-id="68d82-208">支持</span><span class="sxs-lookup"><span data-stu-id="68d82-208">Supported</span></span> | <span data-ttu-id="68d82-209">支持</span><span class="sxs-lookup"><span data-stu-id="68d82-209">Supported</span></span> |
| [<span data-ttu-id="68d82-210">SpatialPointerInteractionSourcePose：：**ForwardDirection**</span><span class="sxs-lookup"><span data-stu-id="68d82-210">SpatialPointerInteractionSourcePose::**ForwardDirection**</span></span>](//uwp/api/windows.ui.input.spatial.spatialpointerinteractionsourcepose.forwarddirection#Windows_UI_Input_Spatial_SpatialPointerInteractionSourcePose_ForwardDirection) | <span data-ttu-id="68d82-211">指向射线的方向。</span><span class="sxs-lookup"><span data-stu-id="68d82-211">Direction of the pointing ray.</span></span> | <span data-ttu-id="68d82-212">不支持</span><span class="sxs-lookup"><span data-stu-id="68d82-212">Not Supported</span></span> | <span data-ttu-id="68d82-213">支持</span><span class="sxs-lookup"><span data-stu-id="68d82-213">Supported</span></span> | <span data-ttu-id="68d82-214">支持</span><span class="sxs-lookup"><span data-stu-id="68d82-214">Supported</span></span> |

<span data-ttu-id="68d82-215">以上一些属性在所有设备上都不可用，API 提供了一种方法来测试这一点。</span><span class="sxs-lookup"><span data-stu-id="68d82-215">Some of the above properties aren't available on all devices, and the API provides a means to test for this.</span></span> <span data-ttu-id="68d82-216">例如，你可以检查 [SpatialInteractionSource：： IsGraspSupported](//uwp/api/windows.ui.input.spatial.spatialinteractionsource.isgraspsupported) 属性以确定源是否提供了 "获取" 操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-216">For example, you can inspect the [SpatialInteractionSource::IsGraspSupported](//uwp/api/windows.ui.input.spatial.spatialinteractionsource.isgraspsupported) property to determine whether the source provides a grasp action.</span></span>

### <a name="grip-pose-vs-pointing-pose"></a><span data-ttu-id="68d82-217">手柄姿势与指针姿势</span><span class="sxs-lookup"><span data-stu-id="68d82-217">Grip pose vs. pointing pose</span></span>

<span data-ttu-id="68d82-218">Windows Mixed Reality 支持采用不同外形规格的运动控制器。</span><span class="sxs-lookup"><span data-stu-id="68d82-218">Windows Mixed Reality supports motion controllers in different form factors.</span></span>  <span data-ttu-id="68d82-219">它还支持已表述的手动跟踪系统。</span><span class="sxs-lookup"><span data-stu-id="68d82-219">It also supports articulated hand tracking systems.</span></span>  <span data-ttu-id="68d82-220">这些系统中的所有系统都具有不同的位置和自然的 "前进" 方向之间的关系，应用程序应将这些方向用于用户的指针或呈现对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-220">All of these systems have different relationships between the hand position and the natural "forward" direction that apps should use for pointing or rendering objects in the user's hand.</span></span>  <span data-ttu-id="68d82-221">为支持所有此类情况，可为手动跟踪和运动控制器提供两种类型的3D 姿势。</span><span class="sxs-lookup"><span data-stu-id="68d82-221">To support all of this, there are two types of 3D poses provided for both hand tracking and motion controllers.</span></span>  <span data-ttu-id="68d82-222">第一种是手柄姿势，表示用户的手位置。</span><span class="sxs-lookup"><span data-stu-id="68d82-222">The first is grip pose, which represents the user's hand position.</span></span>  <span data-ttu-id="68d82-223">第二个是指姿势，它表示源自用户的手或控制器的一个指针。</span><span class="sxs-lookup"><span data-stu-id="68d82-223">The second is pointing pose, which represents a pointing ray originating from the user's hand or controller.</span></span> <span data-ttu-id="68d82-224">因此，如果想要呈现 **用户的手** 或 **某个对象**（例如剑或机枪），请使用抓握姿势。</span><span class="sxs-lookup"><span data-stu-id="68d82-224">So, if you want to render **the user's hand** or **an object held in the user's hand**, such as a sword or gun, use the grip pose.</span></span> <span data-ttu-id="68d82-225">如果要从控制器或 raycast 中进行，例如当用户是 \* \* 指向 UI 时，请使用指针姿势。</span><span class="sxs-lookup"><span data-stu-id="68d82-225">If you want to raycast from the controller or hand, for example when the user is \*\*pointing at UI, use the pointing pose.</span></span>

<span data-ttu-id="68d82-226">可以通过 [SpatialInteractionSourceState：:P r) ：： TryGetLocation ( ... )](//uwp/api/windows.ui.input.spatial.spatialinteractionsourceproperties.trygetlocation#Windows_UI_Input_Spatial_SpatialInteractionSourceProperties_TryGetLocation_Windows_Perception_Spatial_SpatialCoordinateSystem_)访问 **抓握姿势**。定义如下：</span><span class="sxs-lookup"><span data-stu-id="68d82-226">You can access the **grip pose** through [SpatialInteractionSourceState::Properties::TryGetLocation(...)](//uwp/api/windows.ui.input.spatial.spatialinteractionsourceproperties.trygetlocation#Windows_UI_Input_Spatial_SpatialInteractionSourceProperties_TryGetLocation_Windows_Perception_Spatial_SpatialCoordinateSystem_). It's defined as follows:</span></span>
* <span data-ttu-id="68d82-227">**手柄位置**：在固定控制器时，掌上质心，向左或向右调整以使其在手柄内居中。</span><span class="sxs-lookup"><span data-stu-id="68d82-227">The **grip position**: The palm centroid when holding the controller naturally, adjusted left or right to center the position within the grip.</span></span>
* <span data-ttu-id="68d82-228">**手柄方向的右轴**：当你完全打开手形成一个平面的5指形姿势时，与你的掌上的光线 (从右手掌向后) </span><span class="sxs-lookup"><span data-stu-id="68d82-228">The **grip orientation's Right axis**: When you completely open your hand to form a flat 5-finger pose, the ray that is normal to your palm (forward from left palm, backward from right palm)</span></span>
* <span data-ttu-id="68d82-229">**手柄方向的正向轴**：当您关闭手中的部分 (时，就如同按住控制器) 一样，通过您的非拇指形来表示 "转发" 的射线。</span><span class="sxs-lookup"><span data-stu-id="68d82-229">The **grip orientation's Forward axis**: When you close your hand partially (as if holding the controller), the ray that points "forward" through the tube formed by your non-thumb fingers.</span></span>
* <span data-ttu-id="68d82-230">**手柄方向的上轴**：向右和向后定义隐含的上轴。</span><span class="sxs-lookup"><span data-stu-id="68d82-230">The **grip orientation's Up axis**: The Up axis implied by the Right and Forward definitions.</span></span>

<span data-ttu-id="68d82-231">可以通过 [SpatialInteractionSourceState：:P r) ：： TryGetLocation ( ... ) ：： SourcePointerPose](/uwp/api/windows.ui.input.spatial.spatialinteractionsourcelocation#Windows_UI_Input_Spatial_SpatialInteractionSourceLocation_SourcePointerPose)或 [SpatialInteractionSourceState：： TryGetPointerPose ( ... ) ：： TryGetInteractionSourcePose](/uwp/api/windows.ui.input.spatial.spatialpointerpose#Windows_UI_Input_Spatial_SpatialPointerPose_TryGetInteractionSourcePose_Windows_UI_Input_Spatial_SpatialInteractionSource_)访问 **指针姿势**。</span><span class="sxs-lookup"><span data-stu-id="68d82-231">You can access the **pointer pose** through [SpatialInteractionSourceState::Properties::TryGetLocation(...)::SourcePointerPose](/uwp/api/windows.ui.input.spatial.spatialinteractionsourcelocation#Windows_UI_Input_Spatial_SpatialInteractionSourceLocation_SourcePointerPose) or [SpatialInteractionSourceState::TryGetPointerPose(...)::TryGetInteractionSourcePose](/uwp/api/windows.ui.input.spatial.spatialpointerpose#Windows_UI_Input_Spatial_SpatialPointerPose_TryGetInteractionSourcePose_Windows_UI_Input_Spatial_SpatialInteractionSource_).</span></span>

## <a name="controller-specific-input-properties"></a><span data-ttu-id="68d82-232">控制器特定的输入属性</span><span class="sxs-lookup"><span data-stu-id="68d82-232">Controller-specific input properties</span></span>
<span data-ttu-id="68d82-233">对于控制器，SpatialInteractionSource 具有具有其他功能的控制器属性。</span><span class="sxs-lookup"><span data-stu-id="68d82-233">For controllers, the SpatialInteractionSource has a Controller property with additional capabilities.</span></span>
* <span data-ttu-id="68d82-234">**HasThumbstick：** 如果为 true，则控制器具有操纵杆。</span><span class="sxs-lookup"><span data-stu-id="68d82-234">**HasThumbstick:** If true, the controller has a thumbstick.</span></span> <span data-ttu-id="68d82-235">检查 SpatialInteractionSourceState 的 [ControllerProperties](/uwp/api/windows.ui.input.spatial.spatialinteractioncontrollerproperties) 属性，以获取操纵杆 x 和 y 值 (ThumbstickX 和 ThumbstickY) 以及其按下状态 (IsThumbstickPressed) 。</span><span class="sxs-lookup"><span data-stu-id="68d82-235">Inspect the [ControllerProperties](/uwp/api/windows.ui.input.spatial.spatialinteractioncontrollerproperties) property of the SpatialInteractionSourceState to acquire the thumbstick x and y values (ThumbstickX and ThumbstickY), as well as its pressed state (IsThumbstickPressed).</span></span>
* <span data-ttu-id="68d82-236">**HasTouchpad：** 如果为 true，则控制器具有触摸板。</span><span class="sxs-lookup"><span data-stu-id="68d82-236">**HasTouchpad:** If true, the controller has a touchpad.</span></span> <span data-ttu-id="68d82-237">检查 SpatialInteractionSourceState 的 ControllerProperties 属性，以获取 (TouchpadX 和 TouchpadY) 的触摸板 x 和 y 值，并了解用户是否触摸板 (IsTouchpadTouched) ，以及是否按下了触摸板 (IsTouchpadPressed) 。</span><span class="sxs-lookup"><span data-stu-id="68d82-237">Inspect the ControllerProperties property of the SpatialInteractionSourceState to acquire the touchpad x and y values (TouchpadX and TouchpadY), and to know if the user is touching the pad (IsTouchpadTouched) and if they're pressing the touchpad down (IsTouchpadPressed).</span></span>
* <span data-ttu-id="68d82-238">**SimpleHapticsController：** 控制器的 SimpleHapticsController API 可用于检查控制器的 haptics 功能，还可用于控制 haptic 反馈。</span><span class="sxs-lookup"><span data-stu-id="68d82-238">**SimpleHapticsController:** The SimpleHapticsController API for the controller allows you to inspect the haptics capabilities of the controller, and it also allows you to control haptic feedback.</span></span>

<span data-ttu-id="68d82-239">对于两个轴 (从下到上，以及从左到右) ，触杆和操纵杆的范围为-1 到1。</span><span class="sxs-lookup"><span data-stu-id="68d82-239">The range for touchpad and thumbstick is -1 to 1 for both axes (from bottom to top, and from left to right).</span></span> <span data-ttu-id="68d82-240">使用 SpatialInteractionSourceState：： SelectPressedValue 属性访问的模拟触发器的范围的范围为0到1。</span><span class="sxs-lookup"><span data-stu-id="68d82-240">The range for the analog trigger, which is accessed using the SpatialInteractionSourceState::SelectPressedValue property, has a range of 0 to 1.</span></span> <span data-ttu-id="68d82-241">值为1时，与 IsSelectPressed 等于 true;与 IsSelectPressed 关联的任何其他值将等于 false。</span><span class="sxs-lookup"><span data-stu-id="68d82-241">A value of 1 correlates with IsSelectPressed being equal to true; any other value correlates with IsSelectPressed being equal to false.</span></span>

## <a name="articulated-hand-tracking"></a><span data-ttu-id="68d82-242">已表述的手动跟踪</span><span class="sxs-lookup"><span data-stu-id="68d82-242">Articulated hand tracking</span></span>
<span data-ttu-id="68d82-243">Windows Mixed Reality API 为已表述的手动跟踪提供完全支持，例如在 HoloLens 2 上。</span><span class="sxs-lookup"><span data-stu-id="68d82-243">The Windows Mixed Reality API provides full support for articulated hand tracking, for example on HoloLens 2.</span></span> <span data-ttu-id="68d82-244">可在应用程序中使用可表述的手动跟踪来实现直接操作和点到提交输入模型。</span><span class="sxs-lookup"><span data-stu-id="68d82-244">Articulated hand tracking can be used to implement direct manipulation and point-and-commit input models in your applications.</span></span> <span data-ttu-id="68d82-245">它还可用于创作完全自定义交互。</span><span class="sxs-lookup"><span data-stu-id="68d82-245">It can also be used to author fully custom interactions.</span></span>

### <a name="hand-skeleton"></a><span data-ttu-id="68d82-246">手写框架</span><span class="sxs-lookup"><span data-stu-id="68d82-246">Hand skeleton</span></span>
<span data-ttu-id="68d82-247">已表述的手动跟踪提供了一个允许多种不同类型的交互的25个接合式主干。</span><span class="sxs-lookup"><span data-stu-id="68d82-247">Articulated hand tracking provides a 25 joint skeleton that enables many different types of interactions.</span></span>  <span data-ttu-id="68d82-248">骨架为索引/中间/环/小手指提供五个接头，为拇指提供四个接合点，并提供一个手腕接头。</span><span class="sxs-lookup"><span data-stu-id="68d82-248">The skeleton provides five joints for the index/middle/ring/little fingers, four joints for the thumb, and one wrist joint.</span></span>  <span data-ttu-id="68d82-249">手腕接头作为层次结构的基础。</span><span class="sxs-lookup"><span data-stu-id="68d82-249">The wrist joint serves as the base of the hierarchy.</span></span> <span data-ttu-id="68d82-250">下图说明了主干的布局。</span><span class="sxs-lookup"><span data-stu-id="68d82-250">The following picture illustrates the layout of the skeleton.</span></span>

![手写框架](images/hand-skeleton.png)

<span data-ttu-id="68d82-252">在大多数情况下，每个接点都基于它所表示的骨骼来命名。</span><span class="sxs-lookup"><span data-stu-id="68d82-252">In most cases, each joint is named based on the bone that it represents.</span></span>  <span data-ttu-id="68d82-253">由于每个接合都有两个骨骼，因此我们使用基于该位置的子骨骼命名每个接合的约定。</span><span class="sxs-lookup"><span data-stu-id="68d82-253">Since there are two bones at every joint, we use a convention of naming each joint based on the child bone at that location.</span></span>  <span data-ttu-id="68d82-254">将子骨骼定义为手腕中的骨骼。</span><span class="sxs-lookup"><span data-stu-id="68d82-254">The child bone is defined as the bone further from the wrist.</span></span>  <span data-ttu-id="68d82-255">例如，"Index 最近" 联合包含 Index 最近骨骼的开始位置和该骨骼的方向。</span><span class="sxs-lookup"><span data-stu-id="68d82-255">For example, the "Index Proximal" joint contains the beginning position of the index proximal bone, and the orientation of that bone.</span></span>  <span data-ttu-id="68d82-256">它不包含骨骼的结束位置。</span><span class="sxs-lookup"><span data-stu-id="68d82-256">It doesn't contain the ending position of the bone.</span></span>  <span data-ttu-id="68d82-257">如果需要，您可以从层次结构中的下一个联合获得，即 "索引中间" 联合。</span><span class="sxs-lookup"><span data-stu-id="68d82-257">If you need that, you'd get it from the next joint in the hierarchy, the "Index Intermediate" joint.</span></span>

<span data-ttu-id="68d82-258">除了25个层次联接外，系统还提供了一种手掌接点。</span><span class="sxs-lookup"><span data-stu-id="68d82-258">In addition to the 25 hierarchical joints, the system provides a palm joint.</span></span>  <span data-ttu-id="68d82-259">手掌通常不被视为主干结构的一部分。</span><span class="sxs-lookup"><span data-stu-id="68d82-259">The palm isn't typically considered part of the skeletal structure.</span></span> <span data-ttu-id="68d82-260">它只是一种方便的方法，可用于获取手的整体位置和方向。</span><span class="sxs-lookup"><span data-stu-id="68d82-260">It's provided only as a convenient way to get the hand's overall position and orientation.</span></span>

<span data-ttu-id="68d82-261">为每个接点提供以下信息：</span><span class="sxs-lookup"><span data-stu-id="68d82-261">The following information is provided for each joint:</span></span>

| <span data-ttu-id="68d82-262">名称</span><span class="sxs-lookup"><span data-stu-id="68d82-262">Name</span></span> | <span data-ttu-id="68d82-263">说明</span><span class="sxs-lookup"><span data-stu-id="68d82-263">Description</span></span> |
|--- |--- |
|<span data-ttu-id="68d82-264">位置</span><span class="sxs-lookup"><span data-stu-id="68d82-264">Position</span></span> | <span data-ttu-id="68d82-265">联合的3D 位置，可用于任何请求的坐标系。</span><span class="sxs-lookup"><span data-stu-id="68d82-265">3D position of the joint, available in any requested coordinate system.</span></span> |
|<span data-ttu-id="68d82-266">方向</span><span class="sxs-lookup"><span data-stu-id="68d82-266">Orientation</span></span> | <span data-ttu-id="68d82-267">骨骼的3D 方向，可用于任何请求的坐标系。</span><span class="sxs-lookup"><span data-stu-id="68d82-267">3D orientation of the bone, available in any requested coordinate system.</span></span> |
|<span data-ttu-id="68d82-268">半径</span><span class="sxs-lookup"><span data-stu-id="68d82-268">Radius</span></span> | <span data-ttu-id="68d82-269">位于接合位置的外观的距离。</span><span class="sxs-lookup"><span data-stu-id="68d82-269">Distance to surface of the skin at the joint position.</span></span> <span data-ttu-id="68d82-270">用于优化依赖于手指宽度的直接交互或可视化效果。</span><span class="sxs-lookup"><span data-stu-id="68d82-270">Useful for tuning direct interactions or visualizations that rely on finger width.</span></span> |
|<span data-ttu-id="68d82-271">精确度</span><span class="sxs-lookup"><span data-stu-id="68d82-271">Accuracy</span></span> | <span data-ttu-id="68d82-272">提供有关系统如何自信地了解此共同信息的提示。</span><span class="sxs-lookup"><span data-stu-id="68d82-272">Provides a hint on how confident the system feels about this joint's information.</span></span> |

<span data-ttu-id="68d82-273">可以通过 [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate)上的函数访问手写框架数据。</span><span class="sxs-lookup"><span data-stu-id="68d82-273">You can access the hand skeleton data through a function on the [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate).</span></span>  <span data-ttu-id="68d82-274">函数被称为 [TryGetHandPose](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.trygethandpose#Windows_UI_Input_Spatial_SpatialInteractionSourceState_TryGetHandPose)，并返回一个名为 [HandPose](//uwp/api/windows.perception.people.handpose)的对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-274">The function is called [TryGetHandPose](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate.trygethandpose#Windows_UI_Input_Spatial_SpatialInteractionSourceState_TryGetHandPose), and it returns an object called [HandPose](//uwp/api/windows.perception.people.handpose).</span></span>  <span data-ttu-id="68d82-275">如果源不支持明确表述，则此函数将返回 null。</span><span class="sxs-lookup"><span data-stu-id="68d82-275">If the source doesn't support articulated hands, then this function will return null.</span></span>  <span data-ttu-id="68d82-276">有了 HandPose 后，就可以通过调用 [TryGetJoint](//uwp/api/windows.perception.people.handpose.trygetjoint#Windows_Perception_People_HandPose_TryGetJoint_Windows_Perception_Spatial_SpatialCoordinateSystem_Windows_Perception_People_HandJointKind_Windows_Perception_People_JointPose__)来获取当前的联合数据，并使用感兴趣的联合的名称。</span><span class="sxs-lookup"><span data-stu-id="68d82-276">Once you have a HandPose, you can get current joint data by calling [TryGetJoint](//uwp/api/windows.perception.people.handpose.trygetjoint#Windows_Perception_People_HandPose_TryGetJoint_Windows_Perception_Spatial_SpatialCoordinateSystem_Windows_Perception_People_HandJointKind_Windows_Perception_People_JointPose__), with the name of the joint you're interested in.</span></span>  <span data-ttu-id="68d82-277">数据返回为 [JointPose](//uwp/api/windows.perception.people.jointpose) 结构。</span><span class="sxs-lookup"><span data-stu-id="68d82-277">The data is returned as a [JointPose](//uwp/api/windows.perception.people.jointpose) structure.</span></span>  <span data-ttu-id="68d82-278">下面的代码获取索引 finger 笔尖的位置。</span><span class="sxs-lookup"><span data-stu-id="68d82-278">The following code gets the position of the index finger tip.</span></span> <span data-ttu-id="68d82-279">变量 *currentState* 表示 [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate)的实例。</span><span class="sxs-lookup"><span data-stu-id="68d82-279">The variable *currentState* represents an instance of [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate).</span></span>

```cpp
using namespace winrt::Windows::Perception::People;
using namespace winrt::Windows::Foundation::Numerics;

auto handPose = currentState.TryGetHandPose();
if (handPose)
{
    JointPose joint;
    if (handPose.TryGetJoint(desiredCoordinateSystem, HandJointKind::IndexTip, joint))
    {
        float3 indexTipPosition = joint.Position;

        // Do something with the index tip position
    }
}
```

### <a name="hand-mesh"></a><span data-ttu-id="68d82-280">手写网格</span><span class="sxs-lookup"><span data-stu-id="68d82-280">Hand mesh</span></span>

<span data-ttu-id="68d82-281">已表述的手动跟踪 API 允许使用完全 deformable 的三角手写网格。</span><span class="sxs-lookup"><span data-stu-id="68d82-281">The articulated hand tracking API allows for a fully deformable triangle hand mesh.</span></span>  <span data-ttu-id="68d82-282">此网格可以与手形框架实时变形，并对可视化和高级物理学技术非常有用。</span><span class="sxs-lookup"><span data-stu-id="68d82-282">This mesh can deform in real time along with the hand skeleton, and is useful for visualization and advanced physics techniques.</span></span>  <span data-ttu-id="68d82-283">若要访问手写网格，需要先通过对[SpatialInteractionSource](//uwp/api/windows.ui.input.spatial.spatialinteractionsource)调用[TryCreateHandMeshObserverAsync](//uwp/api/windows.ui.input.spatial.spatialinteractionsource.trycreatehandmeshobserverasync)来创建一个[HandMeshObserver](//uwp/api/windows.perception.people.handmeshobserver)对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-283">To access the hand mesh, you need to first create a [HandMeshObserver](//uwp/api/windows.perception.people.handmeshobserver) object by calling [TryCreateHandMeshObserverAsync](//uwp/api/windows.ui.input.spatial.spatialinteractionsource.trycreatehandmeshobserverasync) on the [SpatialInteractionSource](//uwp/api/windows.ui.input.spatial.spatialinteractionsource).</span></span>  <span data-ttu-id="68d82-284">每个源仅需执行一次此操作，通常是第一次出现此操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-284">This only needs to be done once per source, typically the first time you see it.</span></span>  <span data-ttu-id="68d82-285">这意味着，只要手进入 FOV，就会调用此函数创建 HandMeshObserver 对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-285">That means you'll call this function to create a HandMeshObserver object whenever a hand enters the FOV.</span></span>  <span data-ttu-id="68d82-286">这是一个异步函数，因此你必须在此处处理一些并发操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-286">This is an async function, so you'll have to deal with a bit of concurrency here.</span></span>  <span data-ttu-id="68d82-287">在可用时，可以通过调用 [GetTriangleIndices](//uwp/api/windows.perception.people.handmeshobserver.gettriangleindices#Windows_Perception_People_HandMeshObserver_GetTriangleIndices_System_UInt16___)来请求三角形索引缓冲区的 HandMeshObserver 对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-287">Once available, you can ask the HandMeshObserver object for the triangle index buffer by calling [GetTriangleIndices](//uwp/api/windows.perception.people.handmeshobserver.gettriangleindices#Windows_Perception_People_HandMeshObserver_GetTriangleIndices_System_UInt16___).</span></span>  <span data-ttu-id="68d82-288">索引不会在帧之间更改帧，因此你可以获得一次框架，并将其缓存在源的生存期内。</span><span class="sxs-lookup"><span data-stu-id="68d82-288">Indices don't change frame over frame, so you can get those once and cache them for the lifetime of the source.</span></span>  <span data-ttu-id="68d82-289">以顺时针缠绕顺序提供索引。</span><span class="sxs-lookup"><span data-stu-id="68d82-289">Indices are provided in clockwise winding order.</span></span>

<span data-ttu-id="68d82-290">下面的代码将向上旋转分离的 std：： thread 来创建网格观察器并在网格观察器可用后提取索引缓冲区。</span><span class="sxs-lookup"><span data-stu-id="68d82-290">The following code spins up a detached std::thread to create the mesh observer and extracts the index buffer once the mesh observer is available.</span></span>  <span data-ttu-id="68d82-291">它从名为 *currentState* 的变量开始，该变量是表示跟踪手的 [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) 的实例。</span><span class="sxs-lookup"><span data-stu-id="68d82-291">It starts from a variable called *currentState*, which is an instance of [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) representing a tracked hand.</span></span>

```cpp
using namespace Windows::Perception::People;

std::thread createObserverThread([this, currentState]()
{
    HandMeshObserver newHandMeshObserver = currentState.Source().TryCreateHandMeshObserverAsync().get();
    if (newHandMeshObserver)
    {
        unsigned indexCount = newHandMeshObserver.TriangleIndexCount();
        vector<unsigned short> indices(indexCount);
        newHandMeshObserver.GetTriangleIndices(indices);

        // Save the indices and handMeshObserver for later use - and use a mutex to synchronize access if needed!
     }
});
createObserverThread.detach();
```
<span data-ttu-id="68d82-292">启动分离的线程只是一种用于处理异步调用的选项。</span><span class="sxs-lookup"><span data-stu-id="68d82-292">Starting a detached thread is just one option for handling async calls.</span></span>  <span data-ttu-id="68d82-293">或者，你可以使用 c + +/WinRT. 支持的新 [co_await](//windows/uwp/cpp-and-winrt-apis/concurrency) 功能</span><span class="sxs-lookup"><span data-stu-id="68d82-293">Alternatively, you could use the new [co_await](//windows/uwp/cpp-and-winrt-apis/concurrency) functionality supported by C++/WinRT.</span></span>

<span data-ttu-id="68d82-294">获得 HandMeshObserver 对象后，应在其对应的 SpatialInteractionSource 处于活动状态的持续时间内保留该对象。</span><span class="sxs-lookup"><span data-stu-id="68d82-294">Once you have a HandMeshObserver object, you should hold onto it for the duration that its corresponding SpatialInteractionSource is active.</span></span>  <span data-ttu-id="68d82-295">然后，每个帧都可以通过调用 [GetVertexStateForPose](//uwp/api/windows.perception.people.handmeshobserver.getvertexstateforpose) 并传入表示想要使用顶点的 [HandPose](//uwp/api/windows.perception.people.handpose) 实例的最新顶点缓冲区来请求该缓冲区。</span><span class="sxs-lookup"><span data-stu-id="68d82-295">Then each frame, you can ask it for the latest vertex buffer that represents the hand by calling [GetVertexStateForPose](//uwp/api/windows.perception.people.handmeshobserver.getvertexstateforpose) and passing in a [HandPose](//uwp/api/windows.perception.people.handpose) instance that represents the pose that you want vertices for.</span></span>  <span data-ttu-id="68d82-296">缓冲区中的每个顶点都有一个位置和一个法线。</span><span class="sxs-lookup"><span data-stu-id="68d82-296">Each vertex in the buffer has a position and a normal.</span></span>  <span data-ttu-id="68d82-297">下面的示例演示如何获取手写网格的当前顶点集。</span><span class="sxs-lookup"><span data-stu-id="68d82-297">Here's an example of how to get the current set of vertices for a hand mesh.</span></span>  <span data-ttu-id="68d82-298">如前所述， *currentState* 变量表示 [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate)的实例。</span><span class="sxs-lookup"><span data-stu-id="68d82-298">As before, the *currentState* variable represents an instance of [SpatialInteractionSourceState](//uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate).</span></span>

```cpp
using namespace winrt::Windows::Perception::People;

auto handPose = currentState.TryGetHandPose();
if (handPose)
{
    std::vector<HandMeshVertex> vertices(handMeshObserver.VertexCount());
    auto vertexState = handMeshObserver.GetVertexStateForPose(handPose);
    vertexState.GetVertices(vertices);

    auto meshTransform = vertexState.CoordinateSystem().TryGetTransformTo(desiredCoordinateSystem);
    if (meshTransform != nullptr)
    {
        // Do something with the vertices and mesh transform, along with the indices that you saved earlier
    }
}
```

<span data-ttu-id="68d82-299">与骨架接点不同，手动网格 API 不允许为顶点指定坐标系统。</span><span class="sxs-lookup"><span data-stu-id="68d82-299">In contrast to skeleton joints, the hand mesh API doesn't allow you to specify a coordinate system for the vertices.</span></span>  <span data-ttu-id="68d82-300">相反， [HandMeshVertexState](//uwp/api/windows.perception.people.handmeshvertexstate) 指定在其中提供顶点的坐标系统。</span><span class="sxs-lookup"><span data-stu-id="68d82-300">Instead, the [HandMeshVertexState](//uwp/api/windows.perception.people.handmeshvertexstate) specifies the coordinate system that the vertices are provided in.</span></span>  <span data-ttu-id="68d82-301">然后，可以通过调用 [TryGetTransformTo](//uwp/api/windows.perception.spatial.spatialcoordinatesystem.trygettransformto#Windows_Perception_Spatial_SpatialCoordinateSystem_TryGetTransformTo_Windows_Perception_Spatial_SpatialCoordinateSystem_) 并指定所需的坐标系统来获取网格转换。</span><span class="sxs-lookup"><span data-stu-id="68d82-301">You can then get a mesh transform by calling [TryGetTransformTo](//uwp/api/windows.perception.spatial.spatialcoordinatesystem.trygettransformto#Windows_Perception_Spatial_SpatialCoordinateSystem_TryGetTransformTo_Windows_Perception_Spatial_SpatialCoordinateSystem_) and specifying the coordinate system you want.</span></span>  <span data-ttu-id="68d82-302">使用顶点时，需要使用此网格转换。</span><span class="sxs-lookup"><span data-stu-id="68d82-302">You'll need to use this mesh transform whenever you work with the vertices.</span></span>  <span data-ttu-id="68d82-303">此方法减少了 CPU 开销，尤其是在使用网格进行呈现的情况下。</span><span class="sxs-lookup"><span data-stu-id="68d82-303">This approach reduces CPU overhead, especially if you're only using the mesh for rendering purposes.</span></span>

## <a name="gaze-and-commit-composite-gestures"></a><span data-ttu-id="68d82-304">注视并提交复合手势</span><span class="sxs-lookup"><span data-stu-id="68d82-304">Gaze and Commit composite gestures</span></span>
<span data-ttu-id="68d82-305">对于使用注视输入模式的应用程序（尤其是在 HoloLens (第一代) 上），空间输入 API 提供了一个可选的 [SpatialGestureRecognizer](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureRecognizer) ，可用于启用在 "select" 事件顶部构建的复合手势。</span><span class="sxs-lookup"><span data-stu-id="68d82-305">For applications using the gaze-and-commit input model, particularly on HoloLens (first gen), the Spatial Input API provides an optional [SpatialGestureRecognizer](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureRecognizer) that can be used to enable composite gestures built on top of the 'select' event.</span></span>  <span data-ttu-id="68d82-306">通过从 SpatialInteractionManager 到全息图的 SpatialGestureRecognizer 的路由交互，应用可以跨手、语音和空间输入设备统一检测点击、保持、操作和导航事件，而无需手动处理按下和释放操作。</span><span class="sxs-lookup"><span data-stu-id="68d82-306">By routing interactions from the SpatialInteractionManager to a hologram's SpatialGestureRecognizer, apps can detect Tap, Hold, Manipulation, and Navigation events uniformly across hands, voice, and spatial input devices, without having to handle presses and releases manually.</span></span>

<span data-ttu-id="68d82-307">SpatialGestureRecognizer 仅执行你请求的笔势集之间的最小歧义。</span><span class="sxs-lookup"><span data-stu-id="68d82-307">SpatialGestureRecognizer does only the minimal disambiguation between the set of gestures that you request.</span></span> <span data-ttu-id="68d82-308">例如，如果只需点击一下，用户就可以随时按下手指，而只需点击一下即可。</span><span class="sxs-lookup"><span data-stu-id="68d82-308">For example, if you request just Tap, the user may hold their finger down as long as they like and a Tap will still occur.</span></span> <span data-ttu-id="68d82-309">如果你同时请求点击和按住，请在大约一秒钟后，将笔势提升为保留，然后点击将不再出现。</span><span class="sxs-lookup"><span data-stu-id="68d82-309">If you request both Tap and Hold, after about a second of holding down their finger the gesture will promote to a Hold and a Tap will no longer occur.</span></span>

<span data-ttu-id="68d82-310">若要使用 SpatialGestureRecognizer，请处理 SpatialInteractionManager 的 [InteractionDetected](/uwp/api/Windows.UI.Input.Spatial.SpatialInteractionManager) 事件，并抓住该处公开的 SpatialPointerPose。</span><span class="sxs-lookup"><span data-stu-id="68d82-310">To use SpatialGestureRecognizer, handle the SpatialInteractionManager's [InteractionDetected](/uwp/api/Windows.UI.Input.Spatial.SpatialInteractionManager) event and grab the SpatialPointerPose exposed there.</span></span> <span data-ttu-id="68d82-311">使用此姿势的用户的头看，将与用户的环境中的全息影像和 surface 网格相交，以确定用户打算与之交互的用户。</span><span class="sxs-lookup"><span data-stu-id="68d82-311">Use the user's head gaze ray from this pose to intersect with the holograms and surface meshes in the user's surroundings to determine what the user is intending to interact with.</span></span> <span data-ttu-id="68d82-312">然后，使用 [CaptureInteraction](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureRecognizer) 方法将事件参数中的 SpatialInteraction 路由到目标全息影像的 SpatialGestureRecognizer。</span><span class="sxs-lookup"><span data-stu-id="68d82-312">Then, route the SpatialInteraction in the event arguments to the target hologram's SpatialGestureRecognizer, using its [CaptureInteraction](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureRecognizer) method.</span></span> <span data-ttu-id="68d82-313">这将根据在创建时或由[TrySetGestureSettings](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureRecognizer)在该识别器上设置的[SpatialGestureSettings](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureSettings)开始解释该交互。</span><span class="sxs-lookup"><span data-stu-id="68d82-313">This starts interpreting that interaction according to the [SpatialGestureSettings](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureSettings) set on that recognizer at creation time - or by [TrySetGestureSettings](/uwp/api/Windows.UI.Input.Spatial.SpatialGestureRecognizer).</span></span>

<span data-ttu-id="68d82-314">在 HoloLens (第一代) 上，交互和手势应从用户的 "注视" 中派生出其目标，而不是在手的位置进行渲染或交互。</span><span class="sxs-lookup"><span data-stu-id="68d82-314">On HoloLens (first gen), interactions and gestures should derive their targeting from the user's head gaze, rather than rendering or interacting at the hand's location.</span></span> <span data-ttu-id="68d82-315">开始交互后，可以使用该手型的相对运动来控制该笔势，如操作或导航手势。</span><span class="sxs-lookup"><span data-stu-id="68d82-315">Once an interaction has started, relative motions of the hand may be used to control the gesture, as with the Manipulation or Navigation gesture.</span></span>

## <a name="see-also"></a><span data-ttu-id="68d82-316">另请参阅</span><span class="sxs-lookup"><span data-stu-id="68d82-316">See also</span></span>
* [<span data-ttu-id="68d82-317">DirectX 中的头部和眼部凝视</span><span class="sxs-lookup"><span data-stu-id="68d82-317">Head and eye gaze in DirectX</span></span>](gaze-in-directx.md)
* [<span data-ttu-id="68d82-318">直接操作输入模型</span><span class="sxs-lookup"><span data-stu-id="68d82-318">Direct manipulation input model</span></span>](../../design/direct-manipulation.md)
* [<span data-ttu-id="68d82-319">点和提交输入模型</span><span class="sxs-lookup"><span data-stu-id="68d82-319">Point-and-commit input model</span></span>](../../design/point-and-commit.md)
* [<span data-ttu-id="68d82-320">注视并提交输入模型</span><span class="sxs-lookup"><span data-stu-id="68d82-320">Gaze and commit input model</span></span>](../../design/gaze-and-commit.md)
* [<span data-ttu-id="68d82-321">运动控制器</span><span class="sxs-lookup"><span data-stu-id="68d82-321">Motion controllers</span></span>](../../design/motion-controllers.md)